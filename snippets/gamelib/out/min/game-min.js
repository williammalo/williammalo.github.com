"use strict";!function(){var t=window.Chainvas={chainable:function n(t){return function(){var n=t.apply(this,arguments);return void 0===n?this:n}},chainablizeOne:function e(n,i){try{t.utils.hasOwnProperty(n,i)&&t.utils.isFunction(n[i])&&(n[i]=t.chainable(n[i]))}catch(a){}return this},chainablize:function i(n,e){var i=n.prototype;if(e)for(var a=e.length;a--;)t.chainablizeOne(i,e[a]);else for(a in i)t.chainablizeOne(i,a);return this},helpers:function a(n,e){var i=n.prototype,a;for(a in t.methods)i&&!(a in i)&&(i[a]=t.methods[a]);return t.extend(i,e),this},extend:function r(t,n){return Chainvas.methods.prop.call(t,n)},global:function o(n,e,i){"string"==typeof n&&(n=[n]);for(var a=n.length;a--;){var r=window[n[a]];r&&t.chainablize(r,i).helpers(r,e)}},methods:{prop:function h(){if(1===arguments.length){var t=arguments[0],n;for(n in t)this[n]=t[n]}else 2===arguments.length&&(this[arguments[0]]=arguments[1]);return this}},utils:{isFunction:function u(t){var n=Object.prototype.toString.call(t);return"[object Function]"===n||"[object Object]"===n&&"call"in t&&"apply"in t&&/^\s*\bfunction\s+\w+\([\w,]*\) \{/.test(t+"")},hasOwnProperty:function s(t,n){try{return t.hasOwnProperty(n)}catch(e){return n in t&&(!t.prototype||!(n in t.prototype)||t.prototype[n]!==t[n])}}}}}(),Chainvas.chainablize(Element),Chainvas.helpers(Element),Chainvas.chainablize(CanvasRenderingContext2D),Chainvas.helpers(CanvasRenderingContext2D),Math.sign=Math.sign||function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1};var sign=Math.sign,abs=Math.abs,min=Math.min,max=Math.max,imgToMap=function t(n,e,i){var a=[],r=n.width,o=n.height;for(e=document.createElement("canvas").prop({width:r,height:o}).getContext("2d").drawImage(n,0,0).getImageData(0,0,r,o).data,i=0;r*o>i;i++)a[i]=e[i<<2]<128;return a.w=r,a.h=o,a},bakedMap=function n(t,e){var i=[],a=t.w,r=t.h,o=e.w,h=e.h,u=o+a,s=h+r,c,p,f;for(c=0;u*s>c;c++)p=c%u,f=c/u|0,i[c]=ᑎ.mapMap(o,h,a,r,p,f,o,h,t,e);return i.w=u,i.h=s,i},key={left:0,right:0,space:0,up:0,down:0,"ᐊ":0,"ᐅ":0,"ᐃ":0,"ᐁ":0};!function(t){onkeydown=function n(e){t(1,e)},onkeyup=function e(n){t(0,n)},t=function i(t,n){key[{37:"left",39:"right",32:"space",38:"up",40:"down"}[n.keyCode]]=t,key[{37:"ᐊ",39:"ᐅ",38:"ᐃ",40:"ᐁ"}[n.keyCode]]=t}}();var loop=function e(t,n){var e=0;for(t=abs(t),e=0;t>e;e++)n(e)};window.fps=30,window.addEventListener("keydown",function(t){if(32==t.keyCode){var n=new Date;loop(1e6,player.update),fps=new Date-n,alert("fps="+Math.round(1e3/window.fps))}}),onload=function i(){var t=480,n=320,e=30,i=2,a=function v(){w.drawImage(this.image,(0|this.x)*i,(0|this.y)*i,this.w*i,this.h*i)},r=document.images[0],o=document.images[1],h=document.images[2],u=document.images[3],s=imgToMap(r),c=imgToMap(u),p=bakedMap(s,c),f={x:0,y:0,w:480,h:320,image:r},d=function y(t,n,e){n|=0,e|=0;var i=0|t.x,a=0|t.y,r=this.x+n|0,o=this.y+e|0,h=0|t.w,u=0|t.h,s=0|this.w,c=0|this.h;return t.hit&&this.hit?ᑎ.mapMap(i,a,h,u,r,o,s,c,t.hit,this.hit):t.hit&&!this.hit?ᑎ.mapBox(i,a,h,u,r,o,s,c,t.hit):!t.hit&&this.hit?ᑎ.boxMap(i,a,h,u,r,o,s,c,this.hit):t.hit||this.hit?void 0:ᑎ.boxBox(i,a,h,u,r,o,s,c)},g=function b(t,n){var e=o.width,i=o.height,a=0,r=o;Object.defineProperties(this,{x:{get:function f(){return t},set:function d(n){return t=n}},y:{get:function g(){return n},set:function l(t){return n=t}},w:{get:function m(){return e},set:function w(t){return e=t}},h:{get:function v(){return i},set:function y(t){return i=t}},vy:{get:function b(){return a},set:function x(t){return a=t}},image:{get:function k(){return r},set:function C(t){return r=t}},hit:{get:function M(){return hit},set:function O(t){return hit=t}}});var u;!function(a,r,o){r=p,a=r.w,o=e,u=function h(e,u){return 0|r[t+e+o+(n+u+i)*a]}}();var s=function z(e,i){var a=!u(e,i);return a&&(t+=e,n+=i),a},c=function E(t){s(t,0)||s(t>>1,-1)||s(t>>2,-2),r=~sign(t)?o:h};this.update=function(){var t=key.ᐅ,n=key.ᐊ,e=key.ᐃ,i=key.ᐁ,r=t-n;r&&c(4*r),e&&u(0,1)&&!u(0,-1)&&(a=-9),s(0,a)||loop(a,function(t){return s(0,sign(a))||(a=0)}),a=min(a+=1,14)}},l=new g(180,150);window.player=l;var m=[f,l];setInterval(function(){w.clearRect(0,0,t*i,n*i);var e,r=m.length;for(e=0;r>e;e++)m[e].update&&m[e].update(),m[e].draw?m[e].draw():m[e].image&&a.apply(m[e])},1e3/e);var w=document.body.appendChild(document.createElement("canvas").prop({width:t*i,height:n*i})).getContext("2d").prop({webkitImageSmoothingEnabled:!1,mozImageSmoothingEnabled:!1})};
!function(){var t=window.Chainvas={chainable:function(t){return function(){var n=t.apply(this,arguments);return void 0===n?this:n}},chainablizeOne:function(n,i){try{t.utils.hasOwnProperty(n,i)&&t.utils.isFunction(n[i])&&(n[i]=t.chainable(n[i]))}catch(e){}return this},chainablize:function(n,i){var e=n.prototype;if(i)for(var a=i.length;a--;)t.chainablizeOne(e,i[a]);else for(a in e)t.chainablizeOne(e,a);return this},helpers:function(n,i){var e=n.prototype,a;for(a in t.methods)e&&!(a in e)&&(e[a]=t.methods[a]);return t.extend(e,i),this},extend:function(t,n){return Chainvas.methods.prop.call(t,n)},global:function(n,i,e){"string"==typeof n&&(n=[n]);for(var a=n.length;a--;){var o=window[n[a]];o&&t.chainablize(o,e).helpers(o,i)}},methods:{prop:function(){if(1===arguments.length){var t=arguments[0],n;for(n in t)this[n]=t[n]}else 2===arguments.length&&(this[arguments[0]]=arguments[1]);return this}},utils:{isFunction:function(t){var n=Object.prototype.toString.call(t);return"[object Function]"===n||"[object Object]"===n&&"call"in t&&"apply"in t&&/^\s*\bfunction\s+\w+\([\w,]*\) \{/.test(t+"")},hasOwnProperty:function(t,n){try{return t.hasOwnProperty(n)}catch(i){return n in t&&(!t.prototype||!(n in t.prototype)||t.prototype[n]!==t[n])}}}}}(),Chainvas.chainablize(Element),Chainvas.helpers(Element),Chainvas.chainablize(CanvasRenderingContext2D),Chainvas.helpers(CanvasRenderingContext2D),function(t,n){for(n in t=Object.getOwnPropertyNames(Math))this[t[n]]=Math[t[n]]}(),Math.sign=Math.sign||function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1};var sign=Math.sign,imgToMap=function(t,n,i){var e=[],a=t.width,o=t.height;for(n=document.createElement("canvas").prop({width:a,height:o}).getContext("2d").drawImage(t,0,0).getImageData(0,0,a,o).data,i=0;a*o>i;i++)e[i]=n[i<<2]<128;return e.w=a,e.h=o,e},key={left:!1,right:!1,space:!1,up:!1,down:!1};!function(t){onkeydown=function(n){t(!0,n)},onkeyup=function(n){t(!1,n)},t=function(t,n){key[{37:"left",39:"right",32:"space",38:"up",40:"down"}[n.keyCode]]=t}}(),onload=function(){"use strict";var t=480,n=320,i=30,e=2,a=function(){m.drawImage(this.image,(0|this.x)*e,(0|this.y)*e,this.w*e,this.h*e)},o=document.images[0],h=document.images[1],r=document.images[2],s=document.images[3],c={x:0,y:0,w:480,h:320,hit:imgToMap(o),image:o},u=function(t,n){var i=0;for(t=abs(t),i=0;t>i;i++)n(i)},l=function(t,n,i){n|=0,i|=0;var e=0|t.x,a=0|t.y,o=this.x+n|0,h=this.y+i|0,r=t.w,s=t.h,c=this.w,u=this.h;return t.hit&&this.hit?ᑎ.mapMap(e,a,r,s,o,h,c,u,t.hit,this.hit):t.hit&&!this.hit?ᑎ.mapBox(e,a,r,s,o,h,c,u,t.hit):!t.hit&&this.hit?ᑎ.boxMap(e,a,r,s,o,h,c,u,this.hit):t.hit||this.hit?void 0:ᑎ.boxBox(e,a,r,s,o,h,c,u)},p={x:180,y:150,w:h.width,h:h.height,vy:0,image:h,hit:imgToMap(s),collides:l,move:function(t,n){var i=!1;return this.collides(c,t,n)||(this.x+=t,this.y+=n,i=!0),i},walk:function(t){var n=sign(t);this.move(t,0)||this.move(t>>1,-1)||this.move(t>>2,-2),this.image=~n?h:r},update:function(){var t=this,n=key.right-key.left;n&&t.walk(4*n),key.up&&t.collides(c,0,1)&&!t.collides(c,0,-1)&&(t.vy=-9),u(t.vy,function(n){t.move(0,sign(t.vy))||(t.vy=0)}),t.vy+=1}},g=[c,p];setInterval(function(){m.clearRect(0,0,t*e,n*e);var i,o=g.length;for(i=0;o>i;i++)g[i].update&&g[i].update(),g[i].draw?g[i].draw():g[i].image&&a.apply(g[i])},1e3/i);var m=document.body.appendChild(document.createElement("canvas").prop({width:t*e,height:n*e})).getContext("2d").prop({webkitImageSmoothingEnabled:!1,mozImageSmoothingEnabled:!1})};